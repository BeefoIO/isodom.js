<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IsoDom Example</title>

    <link rel="stylesheet" href="../src/IsoDom.css">

    <style>
        #objectContainer {
            position: absolute;
            top: 92px;
            left: -144px;
            pointer-events: none;
        }

        #grid .iso-dom__column {
            width: 100px;
            height: 100px;
        }

        img.iso-dom-item {
            pointer-events: none;
        }

        .iso-dom-item img {
            pointer-events: none;
        }

        .actions {
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 9999999;
        }

        .actions__action {
            background: royalblue;
            color: #ffffff;
            font-size: 35px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body style="zoom: 0.7;">

<div class="actions">
    <button class="actions__action" id="newItem">+</button>
</div>

<div id="gridContainer" style="position: absolute; top: 0; left: 0; width: 80%; height: 80%; border: 2px solid red; overflow: auto;"></div>

<script src="../src/IsoDom.js" type="application/javascript"></script>
<script src="../src/plugins/DragAndDrop.js" type="application/javascript"></script>

<script src="items.js" type="application/javascript"></script>
<script>
    items['desk1'] = {
        id: 1,
        name: 'desk1',
        imagePath: "assets/desk1-{orientation}.png",
        orientation: IsoDom.ORIENTATION_SW,
        price: 100,
        bonus: 0.5,
        size: [2, 2],
        tier: 1,
        images: {
            [IsoDom.ORIENTATION_NW]: { url: 'assets/desk1-1.png', offset: { top: -200, left: -150 } },
            [IsoDom.ORIENTATION_NE]: { url: 'assets/desk1-2.png', offset: { top: -200, left: -80 } },
            [IsoDom.ORIENTATION_SE]: { url: 'assets/desk1-3.png', offset: { top: -200, left: -80 } },
            [IsoDom.ORIENTATION_SW]: { url: 'assets/desk1-4.png', offset: { top: -160, left: -170 } },
        },
    };
</script>

<script type="application/javascript">
    let dragAndDrop = new IsoDomDragAndDrop();
    let iso = new IsoDom({
        debug: true,
        plugins: [dragAndDrop],
        target: document.getElementById('gridContainer'),
        columns: 20,
        rows: 20,
        cellSize: [187, 187],
        events: {
            cellCreated(node, cell) {
                node.addEventListener('mouseover', () => {
                    if (dragAndDrop.isDragging()) {
                        let destination = cell;

                        if (iso.isOutOfBounds(dragAndDrop.item, cell.x, cell.y)) {
                            destination = dragAndDrop.closestInBoundCell(cell);
                        }

                        dragAndDrop.setDestination(destination);
                    }
                });

                node.addEventListener('click', () => {
                    if (dragAndDrop.isDragging()) {
                        dragAndDrop.commit();
                    } else if (cell.item) {
                        dragAndDrop.start(cell.item);
                    }
                });

                node.addEventListener('contextmenu', (event) => {
                    event.preventDefault();

                    if (!dragAndDrop.isDragging()) {
                        return false;
                    }

                    dragAndDrop.item.rotate();
                    return false;
                });
            },
        },
        // createItem(item) {
        //     if (item.name === 'desk') {
        //         const root = document.createElement('div');
        //         const img = document.createElement('img');
        //         root.appendChild(img);
        //         item.img = img;
        //         return root;
        //     }
        //
        //     return document.createElement('img');
        // },
        // updateItem(item) {
        //     (item.img || item.el).setAttribute('src', item.image());
        // },
        items: items
    });

    document.body.addEventListener('keydown', (e) => {
        // ESC
        if (e.keyCode === 27 && dragAndDrop.isDragging()) {
            dragAndDrop.cancel();
        }
    });

    document.getElementById('newItem').addEventListener('click', e => {
        e.preventDefault();
        const newItem = new IsoDomItem('closet1', iso);
        dragAndDrop.start(newItem);
    });

    // TEST 3
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 0, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 2, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 4, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 6, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 8, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 10, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 12, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 14, 0);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 16, 0);

    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 0, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 2, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 4, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 6, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 8, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 10, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 12, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 14, 2);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SW }), 16, 2);

    iso.addItem(new IsoDomItem('glass_wall1', iso), 18, 0);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 18, 1);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 18, 3);
    iso.addItem(new IsoDomItem('glass_wall_corner1', iso, { orientation: IsoDom.ORIENTATION_NW }), 18, 4);

    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 0, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 1, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 2, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 3, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 4, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 5, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 6, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 7, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 8, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 9, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 10, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 11, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 12, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 13, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 14, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 15, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 16, 4);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SE }), 17, 4);

    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 0, 5);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 2, 5);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 4, 5);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 6, 5);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 8, 5);

    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 0, 7);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NE }), 2, 7);

    iso.addItem(new IsoDomItem('table_and_chairs1', iso, { orientation: IsoDom.ORIENTATION_NE }), 12, 5);

    iso.addItem(new IsoDomItem('reception_area1', iso, { orientation: IsoDom.ORIENTATION_SW }), 17, 5);
    iso.addItem(new IsoDomItem('reception_area1', iso, { orientation: IsoDom.ORIENTATION_SW }), 17, 9);

    iso.addItem(new IsoDomItem('table_and_chairs1', iso, { orientation: IsoDom.ORIENTATION_SW }), 12, 8);

    iso.addItem(new IsoDomItem('meeting_table1', iso, { orientation: IsoDom.ORIENTATION_SE }), 7, 10);

    iso.addItem(new IsoDomItem('whiteboard2', iso), 12, 7);
    iso.addItem(new IsoDomItem('whiteboard2', iso), 14, 7);

    iso.addItem(new IsoDomItem('couch_black2', iso, { orientation: IsoDom.ORIENTATION_NW }), 19, 12);
    iso.addItem(new IsoDomItem('couch_black2', iso, { orientation: IsoDom.ORIENTATION_NW }), 19, 14);
    iso.addItem(new IsoDomItem('couch_black2', iso, { orientation: IsoDom.ORIENTATION_NW }), 19, 16);
    iso.addItem(new IsoDomItem('couch_black2', iso, { orientation: IsoDom.ORIENTATION_NW }), 19, 18);

    iso.addItem(new IsoDomItem('tv_stand1', iso, { orientation: IsoDom.ORIENTATION_SE }), 17, 13);
    iso.addItem(new IsoDomItem('vending_machine1', iso, { orientation: IsoDom.ORIENTATION_SE }), 17, 15);
    iso.addItem(new IsoDomItem('tv_stand1', iso, { orientation: IsoDom.ORIENTATION_SE }), 17, 17);

    iso.addItem(new IsoDomItem('wall_t1', iso), 16, 13);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 16, 14);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 16, 15);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 16, 16);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 16, 17);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 16, 18);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 16, 19);

    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 14, 14);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 14, 16);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 14, 18);

    iso.addItem(new IsoDomItem('glass_wall1', iso), 13, 14);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 13, 15);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 13, 16);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 13, 17);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 13, 18);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 13, 19);
    iso.addItem(new IsoDomItem('wall_t1', iso), 13, 13);

    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 11, 14);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 11, 16);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 11, 18);

    iso.addItem(new IsoDomItem('glass_wall1', iso), 10, 14);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 10, 15);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 10, 16);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 10, 17);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 10, 18);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 10, 19);
    iso.addItem(new IsoDomItem('wall_t1', iso), 10, 13);

    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SE }), 6, 14);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SE }), 6, 16);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_SE }), 6, 18);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 8, 14);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 8, 16);
    iso.addItem(new IsoDomItem('desk1', iso, { orientation: IsoDom.ORIENTATION_NW }), 8, 18);

    iso.addItem(new IsoDomItem('glass_wall1', iso), 5, 14);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 5, 15);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 5, 16);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 5, 17);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 5, 18);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 5, 19);
    iso.addItem(new IsoDomItem('wall_t1', iso), 5, 13);

    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SW }), 3, 10);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SW }), 3, 11);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SW }), 3, 12);
    iso.addItem(new IsoDomItem('glass_wall1', iso, { orientation: IsoDom.ORIENTATION_SW }), 3, 13);
    iso.addItem(new IsoDomItem('wall_t1', iso, { orientation: IsoDom.ORIENTATION_NE }), 3, 14);
    iso.addItem(new IsoDomItem('glass_wall1', iso), 4, 14);
    iso.addItem(new IsoDomItem('whiteboard2', iso, { orientation: IsoDom.ORIENTATION_NW }), 2, 10);
    iso.addItem(new IsoDomItem('bench_red1', iso, { orientation: IsoDom.ORIENTATION_NW }), 2, 12);

    iso.draw();

</script>

</body>
</html>
