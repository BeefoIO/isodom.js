<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>isodom.js City Example</title>
    <link rel="stylesheet" href="../IsoDom.css">
    <style>
        #container {
            position: relative;
            width: 100%;
            height: 100%;
            border: 2px solid grey;
            overflow: auto;
        }
        .iso-dom {
            transform: rotateX(59.5deg) rotateZ(45deg);
            margin-left: 200px;
        }
    </style>
</head>
<body>

<div id="container">
    <canvas id="isodom"></canvas>
</div>

<p>Assets by: <a href="http://kenney.nl/assets?s=isometric">Kenney.nl</a></p>

<script src="https://code.createjs.com/1.0.0/easeljs.min.js"></script>
<script src="https://code.createjs.com/1.0.0/preloadjs.min.js"></script>
<script src="../IsoDom.js" type="application/javascript"></script>
<script src="../conductors/EaselJs.js" type="application/javascript"></script>
<script>
    var preload = new createjs.LoadQueue();
    preload.addEventListener('complete', () => {

        const conductor = new IsoDomEaselJsConductor({
            target: document.getElementById('isodom'),
            image: preload.getResult('cell'),
            resolve(src) {
                return preload.getResult(src);
            },
        });

        window.iso = new IsoDom(conductor, {
            debug: true,
            columns: 10,
            rows: 10,
            cellSize: [148, 88],
            items: {
                desk1: {
                    orientation: IsoDom.ORIENTATION_SE,
                    size: [2,2],
                    images: {
                        [IsoDom.ORIENTATION_NW]: { url: 'desk1-1', offset: { top: 0, left: 0 } },
                        [IsoDom.ORIENTATION_NE]: { url: 'desk1-2', offset: { top: 0, left: 0 } },
                        [IsoDom.ORIENTATION_SE]: { url: 'desk1-3', offset: { top: -170, left: -50} },
                        [IsoDom.ORIENTATION_SW]: { url: 'desk1-4', offset: { top: 0, left: 0 } },
                    },
                },
                meeting_table1: {
                    orientation: IsoDom.ORIENTATION_SE,
                    size: [3, 6],
                    images: {
                        [IsoDom.ORIENTATION_NE]: {url: 'meeting_table1-1', offset: {top: -135, left: -646}},
                        [IsoDom.ORIENTATION_NW]: {url: 'meeting_table1-2', offset: {top: -128, left: -274}},
                        [IsoDom.ORIENTATION_SW]: {url: 'meeting_table1-3', offset: {top: -135, left: -646}},
                        [IsoDom.ORIENTATION_SE]: {url: 'meeting_table1-4', offset: {top: -360, left: -370}},
                    },
                },
            }
        });

        iso.on({
            itemAdded(item) {
                item.meta.displayObject.scale = 0.55;
                item.meta.displayObject.addEventListener('mouseover', () => {
                    item.meta.displayObject.filters = [
                        new createjs.ColorFilter(1, 1, 1, 1, 10, 10, 10, 0),
                    ];
                    item.meta.displayObject.cache(0, 0, item.meta.displayObject.image.width, item.meta.displayObject.image.height);
                    iso.conductor.stage.update();
                });
                item.meta.displayObject.addEventListener('mouseout', () => {
                    item.meta.displayObject.filters = [
                        new createjs.ColorFilter(1, 1, 1, 1, 0, 0, 0, 0),
                    ];
                    item.meta.displayObject.cache(0, 0, item.meta.displayObject.image.width, item.meta.displayObject.image.height);
                    iso.conductor.stage.update();
                });
                item.meta.displayObject.addEventListener('click', () => {

                });
            },
        });

        iso.conductor.stage.enableMouseOver(20);

        iso.addItem('desk1', 0, 0, { orientation: IsoDom.ORIENTATION_SE });
        iso.addItem('meeting_table1', 0, 2, { orientation: IsoDom.ORIENTATION_SE });
        iso.addItem('meeting_table1', 0, 5, { orientation: IsoDom.ORIENTATION_SE });
        iso.draw();
    });
    preload.loadManifest([
        { src: 'assets/cell.png', id: 'cell' },
        { src: 'assets/desk1-1.png', id: 'desk1-1' },
        { src: 'assets/desk1-2.png', id: 'desk1-2' },
        { src: 'assets/desk1-3.png', id: 'desk1-3' },
        { src: 'assets/desk1-4.png', id: 'desk1-4' },
        { src: 'assets/meeting_table1-1.png', id: 'meeting_table1-1' },
        { src: 'assets/meeting_table1-2.png', id: 'meeting_table1-2' },
        { src: 'assets/meeting_table1-3.png', id: 'meeting_table1-3' },
        { src: 'assets/meeting_table1-4.png', id: 'meeting_table1-4' },
    ]);
</script>
</body>
</html>
